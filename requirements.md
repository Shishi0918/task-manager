# 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
月次タスク管理システム

### 1.2 プロジェクトの目的
経理・会計業務における月次タスクを効率的に管理するWebアプリケーションを構築する。
現在Excelで管理している月次タスクをデジタル化し、複数ユーザーでの進捗共有、タスクの登録・編集、月次切り替えを可能にする。

### 1.3 プロジェクトのスコープ

**対象範囲**:
- 月次タスクのカレンダー表示
- タスクのチェック機能（完了/未完了）
- タスクの登録・編集・削除機能
- 月次の切り替え機能
- 複数ユーザー対応（ユーザー認証）
- レスポンシブデザイン（PC・タブレット・スマホ対応）

**対象外**:
- プロジェクト管理機能
- ファイル添付機能
- 外部カレンダー連携
- 通知機能（メール・プッシュ通知）
- レポート・分析機能

---

## 2. ステークホルダー

### 2.1 関係者
| 役割 | 氏名/組織 | 責任範囲 |
|------|-----------|----------|
| プロジェクトオーナー | | |
| プロジェクトマネージャー | | |
| 開発チーム | | |
| ユーザー代表 | | |

---

## 3. ユーザー要件

### 3.1 想定ユーザー
- 経理担当者
- 会計担当者
- 経理マネージャー
- 月次決算業務に関わるスタッフ

### 3.2 ユーザーストーリー
- **経理担当者として**、月次タスクの進捗を一目で確認したい、なぜなら業務の抜け漏れを防ぎたいから
- **経理マネージャーとして**、チーム全体のタスク進捗を把握したい、なぜならリソース配分を最適化したいから
- **会計担当者として**、完了したタスクをチェックして記録したい、なぜなら作業履歴を残したいから
- **経理担当者として**、新しいタスクを簡単に追加したい、なぜなら月によって業務内容が変わることがあるから

---

## 4. 機能要件

### 4.1 主要機能
| ID | 機能名 | 優先度 | 説明 | 備考 |
|----|--------|--------|------|------|
| F-001 | ユーザー登録 | 高 | 新規ユーザーがアカウントを作成できる | |
| F-002 | ログイン/ログアウト | 高 | ユーザーが認証してシステムにアクセスできる | |
| F-003 | 月次カレンダー表示 | 高 | 指定月のタスクをカレンダー形式で表示 | 日付・曜日表示 |
| F-004 | タスクチェック機能 | 高 | 各日付のタスクを完了/未完了でチェック | リアルタイム更新 |
| F-005 | タスク管理 | 高 | タスクの登録・編集・削除 | CRUD操作 |
| F-006 | 月次切り替え | 高 | 前月・次月・任意の月へ切り替え | カレンダーナビゲーション |
| F-007 | タスクマスタ管理 | 中 | 定型タスクのマスタ登録・管理 | 月初に自動展開 |
| F-008 | 進捗表示 | 中 | 月次の完了率を表示 | ダッシュボード |

### 4.2 機能詳細

#### F-001: ユーザー登録
**概要**: 新規ユーザーがアカウントを作成する

**入力項目**:
- メールアドレス（必須）
- パスワード（必須、8文字以上）
- ユーザー名（必須）

**処理内容**:
1. 入力値のバリデーション
2. メールアドレスの重複チェック
3. パスワードのハッシュ化
4. データベースへの登録

**出力**:
- 成功: ログイン画面へリダイレクト
- 失敗: エラーメッセージの表示

---

#### F-003: 月次カレンダー表示
**概要**: 指定された月のタスクをカレンダー形式で表示する

**表示項目**:
- 年月（例: 2025年5月）
- 日付（1日～月末日）
- 曜日（月～日）
- タスク一覧（縦軸）
- タスクの完了状態（チェックボックス）

**処理内容**:
1. 指定月の日数を計算
2. タスク一覧を取得
3. 各タスクの完了状態を取得
4. カレンダー形式で描画

**初期タスク** (Excelより):
1. 月初預金入力
2. billone仕分け
3. rc買掛入力
4. 資金繰り作成
5. 前月締め作業
6. 報告会
7. 月末振り込み準備
8. 給与入力
9. 月末預金入力

---

#### F-004: タスクチェック機能
**概要**: 各日付のタスクを完了/未完了としてチェックする

**入力**:
- タスクID
- 日付
- 完了状態（true/false）

**処理内容**:
1. ユーザー認証チェック
2. 完了状態をデータベースに保存
3. UIをリアルタイム更新

**出力**:
- チェックボックスの状態更新
- 完了率の再計算

---

#### F-005: タスク管理
**概要**: タスクの追加、編集、削除を行う

**タスク登録**:
- タスク名（必須）
- 表示順序（任意）

**タスク編集**:
- タスク名の変更
- 表示順序の変更

**タスク削除**:
- 削除確認ダイアログ表示
- 関連する完了状態データも削除

---

#### F-006: 月次切り替え
**概要**: 表示する月を切り替える

**操作**:
- 前月ボタン
- 次月ボタン
- 月選択ドロップダウン

**処理**:
1. 選択された月のデータを取得
2. カレンダーを再描画

---

## 5. 非機能要件

### 5.1 パフォーマンス要件
| 項目 | 要件 |
|------|------|
| ページ読み込み時間 | 初回アクセス時3秒以内、2回目以降1秒以内 |
| 同時接続ユーザー数 | 最大1,000ユーザー |
| レスポンスタイム | API応答時間500ms以内 |

### 5.2 可用性要件
- システム稼働率: 99.9%以上
- 定期メンテナンス: 月1回、深夜帯に実施

### 5.3 セキュリティ要件
- パスワードの暗号化（bcrypt等を使用）
- HTTPS通信の必須化
- CSRF対策の実装
- XSS対策の実装
- SQLインジェクション対策
- ユーザー認証にJWT or セッションを使用
- ログイン試行回数の制限（5回まで）

### 5.4 互換性要件

#### ブラウザ対応
- Chrome（最新版および1つ前のバージョン）
- Firefox（最新版および1つ前のバージョン）
- Safari（最新版および1つ前のバージョン）
- Edge（最新版および1つ前のバージョン）

#### デバイス対応
- デスクトップ（1920x1080以上）
- タブレット（768px以上）
- スマートフォン（375px以上）

### 5.5 保守性・拡張性
- コードの可読性を保つ（リンター・フォーマッター使用）
- テストカバレッジ80%以上
- ドキュメントの整備
- モジュール化された設計

---

## 6. システム構成

### 6.1 技術スタック
| レイヤー | 技術 | バージョン |
|----------|------|-----------|
| フロントエンド | React + TypeScript | 18.x / 5.x |
| UIフレームワーク | Tailwind CSS or Material-UI | 最新 |
| 状態管理 | React Context API or Zustand | - |
| バックエンド | Node.js + Express + TypeScript | 20.x / 4.x |
| ORM | Prisma or TypeORM | 最新 |
| データベース | PostgreSQL | 16.x |
| 認証 | JWT (jsonwebtoken) | 最新 |
| バリデーション | Zod | 最新 |
| ビルドツール | Vite | 最新 |
| パッケージマネージャー | npm or pnpm | 最新 |

### 6.2 アーキテクチャ

**システム構成**:
```
[ブラウザ (React SPA)]
        ↓ HTTPS
[Nginx / Reverse Proxy]
        ↓
[Express API Server]
        ↓
[PostgreSQL Database]
```

**フォルダ構成**:
```
project/
├── frontend/          # React フロントエンド
│   ├── src/
│   │   ├── components/  # UIコンポーネント
│   │   ├── pages/       # ページコンポーネント
│   │   ├── hooks/       # カスタムフック
│   │   ├── services/    # API通信
│   │   ├── types/       # TypeScript型定義
│   │   └── utils/       # ユーティリティ
│   └── package.json
│
├── backend/           # Express バックエンド
│   ├── src/
│   │   ├── controllers/ # コントローラー
│   │   ├── routes/      # ルーティング
│   │   ├── models/      # データモデル
│   │   ├── middleware/  # ミドルウェア
│   │   ├── services/    # ビジネスロジック
│   │   └── utils/       # ユーティリティ
│   ├── prisma/          # Prismaスキーマ
│   └── package.json
│
└── README.md
```

---

## 7. データ要件

### 7.1 主要なデータモデル

#### ユーザーテーブル (users)
| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | UUID | PRIMARY KEY | ユーザーID |
| email | VARCHAR(255) | UNIQUE, NOT NULL | メールアドレス |
| password_hash | VARCHAR(255) | NOT NULL | ハッシュ化されたパスワード |
| username | VARCHAR(50) | NOT NULL | ユーザー名 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### タスクマスタテーブル (tasks)
| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | UUID | PRIMARY KEY | タスクID |
| name | VARCHAR(100) | NOT NULL | タスク名 |
| display_order | INTEGER | NOT NULL | 表示順序 |
| is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | 有効フラグ |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### タスク完了状態テーブル (task_completions)
| カラム名 | データ型 | 制約 | 説明 |
|----------|----------|------|------|
| id | UUID | PRIMARY KEY | レコードID |
| task_id | UUID | FOREIGN KEY (tasks.id), NOT NULL | タスクID |
| user_id | UUID | FOREIGN KEY (users.id), NOT NULL | ユーザーID |
| target_date | DATE | NOT NULL | 対象日 |
| is_completed | BOOLEAN | NOT NULL, DEFAULT FALSE | 完了フラグ |
| completed_at | TIMESTAMP | NULL | 完了日時 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

**UNIQUE制約**: (task_id, user_id, target_date)

### 7.2 データの関連

```
users (1) ----< (N) task_completions
tasks (1) ----< (N) task_completions
```

### 7.3 初期データ

**タスクマスタの初期データ** (Excelから抽出):
1. 月初預金入力
2. billone仕分け
3. rc買掛入力
4. 資金繰り作成
5. 前月締め作業
6. 報告会
7. 月末振り込み準備
8. 給与入力
9. 月末預金入力

---

## 8. インターフェース要件

### 8.1 外部システム連携
| システム名 | 連携方法 | 用途 |
|-----------|----------|------|
| [例: 決済API] | REST API | 決済処理 |
| [例: メール配信サービス] | SMTP/API | メール送信 |

### 8.2 API仕様

#### エンドポイント一覧

**認証API**
| メソッド | エンドポイント | 説明 | 認証 |
|---------|---------------|------|------|
| POST | /api/auth/register | ユーザー登録 | 不要 |
| POST | /api/auth/login | ログイン | 不要 |
| POST | /api/auth/logout | ログアウト | 必要 |
| GET | /api/auth/me | ログインユーザー情報取得 | 必要 |

**タスクAPI**
| メソッド | エンドポイント | 説明 | 認証 |
|---------|---------------|------|------|
| GET | /api/tasks | タスク一覧取得 | 必要 |
| POST | /api/tasks | タスク登録 | 必要 |
| PUT | /api/tasks/:id | タスク更新 | 必要 |
| DELETE | /api/tasks/:id | タスク削除 | 必要 |

**タスク完了状態API**
| メソッド | エンドポイント | 説明 | 認証 |
|---------|---------------|------|------|
| GET | /api/completions?year=2025&month=5 | 月次完了状態取得 | 必要 |
| POST | /api/completions | 完了状態登録/更新 | 必要 |
| GET | /api/completions/stats?year=2025&month=5 | 月次進捗統計取得 | 必要 |

#### API詳細仕様例

**POST /api/auth/login**
```json
Request:
{
  "email": "user@example.com",
  "password": "password123"
}

Response (200 OK):
{
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "username": "ユーザー名"
  },
  "token": "jwt-token"
}
```

**GET /api/completions?year=2025&month=5**
```json
Response (200 OK):
{
  "year": 2025,
  "month": 5,
  "tasks": [
    {
      "id": "task-uuid",
      "name": "月初預金入力",
      "display_order": 1,
      "completions": {
        "2025-05-01": true,
        "2025-05-02": false,
        ...
      }
    }
  ]
}
```

**POST /api/completions**
```json
Request:
{
  "task_id": "uuid",
  "target_date": "2025-05-01",
  "is_completed": true
}

Response (200 OK):
{
  "id": "uuid",
  "task_id": "uuid",
  "target_date": "2025-05-01",
  "is_completed": true,
  "completed_at": "2025-05-01T10:30:00Z"
}
```

---

## 9. UI/UX要件

### 9.1 デザインガイドライン
- [デザインシステムやスタイルガイドへの参照]
- カラースキーム: [色の指定]
- フォント: [使用フォント]

### 9.2 アクセシビリティ
- WCAG 2.1 レベルAA準拠
- キーボード操作のサポート
- スクリーンリーダー対応

---

## 10. 制約事項

### 10.1 技術的制約
- [使用できる/できない技術、ライブラリなど]

### 10.2 ビジネス上の制約
- 予算: [金額]
- スケジュール: [期限]
- リソース: [人数や工数]

### 10.3 法的制約
- 個人情報保護法の遵守
- [その他関連する法規制]

---

## 11. 前提条件・依存関係

- [プロジェクト開始の前提条件]
- [他システムやプロジェクトへの依存関係]

---

## 12. リスク管理

| リスク項目 | 影響度 | 発生確率 | 対策 |
|-----------|--------|---------|------|
| [リスク1] | 高/中/低 | 高/中/低 | [対策内容] |
| [リスク2] | 高/中/低 | 高/中/低 | [対策内容] |

---

## 13. テスト要件

### 13.1 テスト種別
- 単体テスト
- 統合テスト
- E2Eテスト
- パフォーマンステスト
- セキュリティテスト

### 13.2 テスト環境
- 開発環境
- ステージング環境
- 本番環境

---

## 14. 運用要件

### 14.1 監視
- アプリケーションログの監視
- エラーレートの監視
- パフォーマンスメトリクスの監視

### 14.2 バックアップ
- データベースの日次バックアップ
- 保持期間: 30日間

### 14.3 障害対応
- 障害発生時の連絡フロー
- 復旧手順書の整備

---

## 15. マイルストーン

| フェーズ | 期間 | 成果物 |
|---------|------|--------|
| 要件定義 | [期間] | 要件定義書 |
| 基本設計 | [期間] | 基本設計書 |
| 詳細設計 | [期間] | 詳細設計書 |
| 実装 | [期間] | ソースコード |
| テスト | [期間] | テスト結果報告書 |
| リリース | [期間] | 本番環境への展開 |

---

## 16. 用語集

| 用語 | 定義 |
|------|------|
| [用語1] | [定義] |
| [用語2] | [定義] |

---

## 17. 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| プロジェクトオーナー | | | |
| プロジェクトマネージャー | | | |

---

## 改訂履歴

| バージョン | 日付 | 更新者 | 更新内容 |
|-----------|------|--------|---------|
| 1.0 | YYYY-MM-DD | | 初版作成 |
